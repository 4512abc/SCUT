# Chapter 8（Performance）

“性能关注系统对事件刺激的时间响应，可用吞吐与延迟度量。提升性能要么控制资源需求，要么管理资源：通过增加资源、提高并发、复制计算/数据、限制队列上界与资源调度来降低争用与阻塞。设计时可用性能检查表从责任分配、协调模型、数据模型、映射、资源管理、绑定时间与技术选型七个维度系统化检查性能风险。”

## 一、Chapter 8 必背定义（22个，全部“可直接默写”）

1. **Performance（性能）** — 指系统在时间维度上满足时序要求的能力：事件发生后系统必须“及时响应”。
2. **Timing requirement（时序/时间要求）** — 对“响应是否在规定时间内完成”的约束，是性能关注的核心。
3. **Event（事件）** — 触发系统响应的外部/内部发生：中断、消息、用户/外系统请求、时钟事件等。
4. **Time-based response（基于时间的响应）** — 系统对事件的处理结果不仅看“对不对”，更看“多久做完”。
5. **Characterize events（事件刻画）** — 把“会发生什么事件、何时发生、发生频率/到达模式、系统需多快响应”说清楚，就是在讨论性能。
6. **Latency（延迟/时延）** — 单次请求从到达到完成响应的时间指标；常用于交互系统的“快不快”。
7. **Throughput（吞吐量）** — 单位时间内系统处理完成的事件/事务数量；常用于“处理能力/容量”。
8. **Demand（需求/负载需求）** — 事件流对系统资源提出的消耗压力（到达率、计算量、I/O 等）。
9. **Resource（资源）** — 系统用来服务事件的能力载体：CPU、内存、网络、磁盘等。
10. **Resource contention（资源争用）** — 多个事件/组件竞争同一资源导致等待与延迟上升；复制/调度等战术常用于缓解。
11. **Blocked time（阻塞时间）** — 因等待资源/锁/队列而产生的时间；并发化可降低阻塞时间。
12. **Performance tactics（性能战术）** — 目标是让事件到达系统后在某个“时间约束”内得到响应的一组设计决策。
13. **Two tactic families（两大类战术）** — 性能改进的两条路：**控制资源需求（reduce demand）** 或 **更好地管理资源（manage resources）**。
14. **Control Resource Demand（控制资源需求）** — 通过减少/整形事件负载来降低资源消耗，从而改善延迟/可预测性。
15. **Manage Sampling Rate（管理采样率）** — 降低数据流采样频率来降低需求，但通常伴随精度/保真度下降。
16. **Limit Event Response（限制事件响应）** — 只处理到某个最大速率，多余事件延后/丢弃，以换取处理的可预测性。
17. **Prioritize Events（事件优先级）** — 给事件分级，优先服务关键事件，保证重要需求先达标。
18. **Reduce Overhead（降低开销）** — 中介/间接层（对可修改性有利）会增加处理事件的资源消耗；减少中介可降低延迟。
19. **Bound Execution Times（限制执行时间）** — 给响应事件的执行时间设上限，避免少数请求拖垮整体时延。
20. **Increase Resource Efficiency（提升资源效率）** — 优化关键路径算法/实现，降低单位事件资源消耗，从而降低延迟。
21. **Manage Resources（管理资源）** — 在既定需求下，通过增加/并发/复制/队列/调度等方式更有效服务事件流。
22. **Key “manage resource” tactics（管理资源的典型战术）** —

- **Increase Resources（增加资源）**：更快 CPU/更多处理器/更多内存/更快网络；
- **Increase Concurrency（提高并发）**：多线程/多事件流并行处理以降低阻塞时间；
- **Maintain Multiple Copies of Computations（复制计算）**：用副本减少单点计算争用；
- **Maintain Multiple Copies of Data（复制数据）**：多份数据放在不同访问速度的存储上；
- **Bound Queue Sizes（限制队列大小）**：限制排队到达数从而限制资源占用；
- **Schedule Resources（资源调度）**：争用时必须制定调度策略。

> 一句话总括（你可当“性能定义+方法论”背）：
> **性能=在特定需求（demand）下管理系统资源以达到可接受的时间行为；指标主要是吞吐与延迟；提升方式是降低需求或更好管理资源。**

------

## 二、10个对比题：标准答案（直接按点写）

### 1) **Structure vs View**

**答：**

- **Structure** 是系统真实存在的元素及其关系的集合；
- **View** 是对一个或多个结构的“表示/文档化呈现”，面向干系人阅读与使用；
- 结论：**架构师设计结构，文档化为视图**。

### 2) **Module vs Component**

**答：**

- **Module** 偏“实现单元/代码组织/职责分配”（构造或采购的代码/数据单元），不强调运行态；
- **Component** 偏“运行时执行实体”，有运行时行为；
- 二者映射通常 **many-to-many**，不要假设一一对应。

### 3) **Layer vs Tier**

**答：**

- **Layer（层）** 是模块结构概念：抽象“虚拟机”，提供内聚服务并以受控方式使用下层（严格分层可限制只能用相邻下一层）；
- **Tier（层级/部署分组）** 是执行/部署结构概念：把组件按“逻辑分组”组织成若干组执行结构，每组称 tier；
- 结论：**Layer=代码/职责分层；Tier=部署/执行分组**。

### 4) **Pattern vs Tactic**

**答：**

- **Pattern（模式）**：一揽子、反复出现的设计决策包，描述一类架构；
- **Tactic（战术）**：更细粒度、直接影响质量属性响应的设计决策；
- 关系：**模式由战术构成（pattern 像分子，tactic 像原子）**，且模式往往需要战术增强以满足特定系统需求。

### 5) **Latency vs Throughput**

**答：**

- **Latency**：单次请求“多快完成”；
- **Throughput**：单位时间“能完成多少”；
- 典型关系：提升吞吐不一定降低延迟（可能排队更长），需结合场景选择指标。

### 6) **Demand vs Resource**

**答：**

- **Demand**：事件流对资源的消耗压力；
- **Resource**：用于服务事件的能力载体（CPU/内存/网络等）；
- 性能问题本质是：**在特定 demand 下管理 resource 达到可接受时间行为**。

### 7) **Control Resource Demand vs Manage Resources**

**答：**

- **控制需求**：减少/整形事件负载（采样率、限流、优先级、减少中介等）；
- **管理资源**：扩容/并发/复制/队列/调度等；
- 结论：性能提升基本就这两条路。

### 8) **Maintain Multiple Copies of Computations vs Maintain Multiple Copies of Data**

**答：**

- **复制计算**：用多个计算副本分担请求，减少“所有计算在单服务器上”带来的争用；
- **复制数据**：把数据放多份/分层存储（不同访问速度），降低访问瓶颈；
- 二者分别对准不同瓶颈：CPU/服务端争用 vs 数据访问路径。

### 9) **Bound Queue Sizes vs Schedule Resources**

**答：**

- **限制队列大小**：限制排队到达数，进而限制资源占用与排队延迟的失控；
- **资源调度**：当资源争用不可避免时，必须定义调度策略来决定谁先用资源；
- 结论：前者偏“限制规模”，后者偏“分配规则”。

### 10) **Limit Event Response vs Prioritize Events**

**答：**

- **限流（Limit Event Response）**：设置最大处理速率，超出部分延后/丢弃，换可预测性；
- **优先级（Prioritize Events）**：不削减总量的前提下先服务关键事件；
- 结论：限流解决“量太大”，优先级解决“谁更重要”。

------

## 三、6道简答题：标准答案（直接照抄）

### 1）简答：什么是性能？性能讨论的“本质”是什么？

**答：**性能是关于时间的质量属性，指系统在事件发生后满足时序要求的能力；当中断/消息/请求/时钟事件发生时，系统必须在规定时间内响应。讨论性能的本质是刻画“会发生哪些事件、何时发生，以及系统对这些事件的时间响应”。

### 2）简答：性能用哪些指标衡量？适用哪些系统类型？

**答：**性能通常用 **吞吐量（throughput）** 与 **延迟（latency）** 来衡量；该度量适用于交互式系统与嵌入式实时系统。

### 3）简答：提高性能的两类基本方法是什么？各举至少3个战术。

**答：**两类方法：
(1) **控制资源需求（Control Resource Demand）**：管理采样率、限制事件响应速率、事件优先级、减少中介开销、限制执行时间、提升资源效率（优化关键算法）。
(2) **管理资源（Manage Resources）**：增加资源、提高并发、复制计算副本、复制数据副本、限制队列大小、资源调度。

### 4）简答：为什么“减少中介（intermediaries）”能提升性能？代价是什么？

**答：**中介（常用于提高可修改性）会在事件处理路径中引入额外调用/数据搬运/协议转换，从而增加资源消耗并拉高延迟；移除中介可减少处理开销、改善延迟。代价是可能牺牲可修改性（因为中介往往承担解耦与隔离变化）。

### 5）简答：复制计算/复制数据分别解决什么性能问题？一句话写清楚。

**答：**复制计算的目的是通过多个计算副本分担请求，减少所有计算集中在单服务器带来的争用；复制数据是把数据保留多份并放在不同访问速度的存储上，以降低数据访问瓶颈并改善响应时间。

### 6）简答：用一句“架构层”的话解释性能问题的根因与改进方向（写成论述题首段）。

**答：**性能问题本质是在特定类型的负载需求（demand）下对系统资源（resources）进行管理以达到可接受的时间行为；因此架构改进要么降低需求（如采样率/限流/优先级/减少开销），要么更合理地管理资源（如扩容/并发/复制/队列/调度），并最终用吞吐量与延迟验证效果。

