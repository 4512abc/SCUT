# Lec7 Sorting(2)

> æ¥ä¸‹æ¥ç™»åœºçš„æ˜¯$O(nlogn)$çš„ç®—æ³•ã€‚ğŸ˜

## å †æ’åº

---

### 1. **å †æ’åºçš„æ ¸å¿ƒæ¦‚å¿µ**

1. **å †çš„å®šä¹‰ï¼š**
   - **æœ€å¤§å †ï¼ˆMax-Heapï¼‰ï¼š** æ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºæˆ–ç­‰äºå…¶å­èŠ‚ç‚¹çš„å€¼ã€‚
   - **æ•°ç»„è¡¨ç¤ºï¼š**
     - æ ¹èŠ‚ç‚¹ï¼š$ A[1] $ã€‚
     - å·¦å­èŠ‚ç‚¹ï¼š$ A[2i] $ï¼Œå³å­èŠ‚ç‚¹ï¼š$ A[2i+1] $ã€‚
     - å †çš„å¤§å°ç”±å½“å‰èŠ‚ç‚¹æ•° $ N $ å†³å®šã€‚

2. **å †æ’åºæµç¨‹ï¼š**
   - **æ„å»ºæœ€å¤§å †ï¼š** å°†åŸå§‹æ•°ç»„è°ƒæ•´ä¸ºä¸€ä¸ªæ»¡è¶³å †æ€§è´¨çš„æœ€å¤§å †ã€‚
   - **é‡å¤æ‰§è¡Œåˆ é™¤æœ€å¤§å€¼ï¼ˆDeleteMaxï¼‰ï¼š**
     - æ¯æ¬¡åˆ é™¤å †é¡¶å…ƒç´ ï¼ˆæœ€å¤§å€¼ï¼‰ã€‚
     - å°†å †é¡¶å…ƒç´ æ”¾åˆ°æ•°ç»„å°¾éƒ¨ï¼Œå †å¤§å°å‡ä¸€ã€‚
     - è°ƒæ•´å‰©ä½™å †ä¸ºæœ€å¤§å †ã€‚

---

### 2. **å †æ’åºçš„å®ç°æ­¥éª¤**

1. **æ„å»ºæœ€å¤§å †ï¼š**  
   - ä»æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¼€å§‹ï¼Œå‘ä¸Šè°ƒæ•´æ¯ä¸ªå­å †ä½¿å…¶æ»¡è¶³æœ€å¤§å †æ€§è´¨ã€‚
   - è°ƒæ•´æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º $ O(\log N) $ï¼Œæ•´ä½“å»ºå †æ—¶é—´å¤æ‚åº¦ä¸º $ O(N) $ã€‚

2. **åˆ é™¤æœ€å¤§å€¼å¹¶æ’åºï¼š**
   - æ¯æ¬¡å°†å †é¡¶å…ƒç´ ä¸å †å°¾å…ƒç´ äº¤æ¢ï¼Œå¹¶ä»å †ä¸­ç§»é™¤å †å°¾ï¼ˆå½“å‰æœ€å¤§å€¼ï¼‰ã€‚
   - è°ƒæ•´å‰©ä½™å †ä¸ºæœ€å¤§å †ã€‚
   - é‡å¤ $ N $ æ¬¡ï¼Œæœ€ç»ˆæ•°ç»„æŒ‰å‡åºæ’åˆ—ã€‚

3. **æ³¨æ„äº‹é¡¹ï¼š**
   - å †æ’åºæ˜¯åŸåœ°æ’åºï¼Œä¸éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´ã€‚
   - å †æ’åº**ä¸ç¨³å®š**ï¼Œå› ä¸ºå †è°ƒæ•´å¯èƒ½æ”¹å˜ç›¸åŒå€¼å…ƒç´ çš„ç›¸å¯¹é¡ºåºã€‚

---

### 3. **å †æ’åºçš„ä»£ç å®ç°**

```cpp
#include <iostream>
#include <vector>
using namespace std;

// ä¸‹æ²‰æ“ä½œï¼Œè°ƒæ•´ä»¥ç´¢å¼•iä¸ºæ ¹çš„å­å †ä¸ºæœ€å¤§å †
void heapify(vector<int>& arr, int n, int i) {
    int largest = i;          // åˆå§‹åŒ–æœ€å¤§å€¼ç´¢å¼•ä¸ºæ ¹èŠ‚ç‚¹
    int left = 2 * i + 1;     // å·¦å­èŠ‚ç‚¹
    int right = 2 * i + 2;    // å³å­èŠ‚ç‚¹

    // æ¯”è¾ƒå·¦å³å­èŠ‚ç‚¹ä¸æ ¹èŠ‚ç‚¹
    if (left < n && arr[left] > arr[largest])
        largest = left;
    if (right < n && arr[right] > arr[largest])
        largest = right;

    // å¦‚æœæœ€å¤§å€¼ä¸æ˜¯æ ¹èŠ‚ç‚¹ï¼Œäº¤æ¢å¹¶é€’å½’è°ƒæ•´
    if (largest != i) {
        swap(arr[i], arr[largest]);
        heapify(arr, n, largest);
    }
}

// å †æ’åºä¸»å‡½æ•°
void heapSort(vector<int>& arr) {
    int n = arr.size();

    // æ„å»ºæœ€å¤§å †
    for (int i = n / 2 - 1; i >= 0; i--)
        heapify(arr, n, i);

    // é€æ­¥ç§»é™¤å †é¡¶å…ƒç´ 
    for (int i = n - 1; i > 0; i--) {
        swap(arr[0], arr[i]);    // å°†æœ€å¤§å€¼æ”¾åˆ°æ•°ç»„æœ«å°¾
        heapify(arr, i, 0);      // è°ƒæ•´å‰©ä½™å †ä¸ºæœ€å¤§å †
    }
}

int main() {
    vector<int> arr = {3, 5, 10, 8, 7, 2, 8, 1, 20, 6};
    heapSort(arr);
    for (auto num : arr) cout << num << " ";
    return 0;
}
```

---

### 4. **å †æ’åºçš„å¤æ‚åº¦åˆ†æ**

| **é˜¶æ®µ**           | **æ—¶é—´å¤æ‚åº¦**    | **è¯´æ˜**                                           |
| ------------------ | ----------------- | -------------------------------------------------- |
| æ„å»ºæœ€å¤§å †         | $ O(N) $        | æ¯ä¸ªèŠ‚ç‚¹è°ƒæ•´ $ O(\log N) $ï¼Œæ€»èŠ‚ç‚¹æ•° $ N/2 $ã€‚ |
| åˆ é™¤æœ€å¤§å€¼å¹¶è°ƒæ•´å † | $ O(N \log N) $ | åˆ é™¤ $ N $ æ¬¡ï¼Œæ¯æ¬¡è°ƒæ•´å † $ O(\log N) $ã€‚      |
| **æ€»å¤æ‚åº¦**       | $ O(N \log N) $ | æ„å»ºå † + åˆ é™¤æœ€å¤§å€¼ä¸¤éƒ¨åˆ†ç›¸åŠ ã€‚                    |

---

### 5. **å †æ’åºæ€§è´¨æ€»ç»“**

- **ç©ºé—´å¤æ‚åº¦ï¼š** $ O(1) $ï¼ŒåŸåœ°æ’åºã€‚
- **ç¨³å®šæ€§ï¼š** ä¸ç¨³å®šï¼Œå› å †è°ƒæ•´ä¼šæ”¹å˜ç›¸åŒå€¼å…ƒç´ çš„ç›¸å¯¹é¡ºåºã€‚
- **æœ€ä¼˜ã€æœ€åå’Œå¹³å‡æ—¶é—´å¤æ‚åº¦ï¼š** $ O(N \log N) $ã€‚

---

### 6. **å †æ’åºçš„ä¼˜ç¼ºç‚¹**

**ä¼˜ç‚¹ï¼š**
- æ—¶é—´å¤æ‚åº¦ç¨³å®šä¸º $ O(N \log N) $ï¼Œå¯¹æ•°æ®åˆ†å¸ƒä¸æ•æ„Ÿã€‚
- ä¸éœ€è¦é¢å¤–å­˜å‚¨ç©ºé—´ï¼Œé€‚åˆå†…å­˜æœ‰é™çš„åœºæ™¯ã€‚

**ç¼ºç‚¹ï¼š**

- ä¸ç¨³å®šã€‚
- å¸¸æ•°æ—¶é—´å¼€é”€è¾ƒå¤§ï¼Œå®é™…æ•ˆç‡ä¸å¦‚å¿«é€Ÿæ’åºã€‚

---

### 7. **ç¤ºä¾‹æ“ä½œæ¼”ç¤º**

**åˆå§‹æ•°ç»„ï¼š**  
$ 3, 5, 10, 8, 7, 2, 8, 1, 20, 6 $

1. **æ„å»ºæœ€å¤§å †ï¼š**  
   $ 20, 8, 10, 6, 7, 2, 8, 1, 5, 3 $

2. **åˆ é™¤æœ€å¤§å€¼å¹¶æ’åºï¼š**
   - ç§»åŠ¨æœ€å¤§å€¼ $ 20 $ åˆ°æ•°ç»„æœ«å°¾ï¼Œè°ƒæ•´å‰©ä½™å †ï¼š  
     $ 10, 8, 8, 6, 7, 2, 3, 1, 5, 20 $
   - é‡å¤ç›´åˆ°å †ä¸ºç©ºã€‚

**æœ€ç»ˆæ’åºç»“æœï¼š**  
$ 1, 2, 3, 5, 6, 7, 8, 8, 10, 20 $

---

### 8. **é€‚ç”¨åœºæ™¯**

- æ•°æ®é‡å¤§ï¼Œå†…å­˜ç©ºé—´æœ‰é™ã€‚
- å¯¹æ’åºç¨³å®šæ€§æ²¡æœ‰ä¸¥æ ¼è¦æ±‚ã€‚

### å›¾ç¤º

![image-20241120111724357](C:\Totoro.trip\blog-demo\source\images\image-20241120111724357.png)

![image-20241120111733632](C:\Totoro.trip\blog-demo\source\images\image-20241120111733632.png)

![image-20241120111739322](C:\Totoro.trip\blog-demo\source\images\image-20241120111739322.png)

## **åˆ†æ²»æ³• (Divide and Conquer)**  

### æ ¸å¿ƒæ€æƒ³ï¼š  
- **åˆ†è§£**ï¼šå°†é—®é¢˜åˆ†è§£ä¸ºè¾ƒå°çš„éƒ¨åˆ†ã€‚  
- **å¤„ç†**ï¼šç‹¬ç«‹è§£å†³è¿™äº›éƒ¨åˆ†ã€‚  
- **åˆå¹¶**ï¼šå°†è¿™äº›éƒ¨åˆ†çš„è§£å†³æ–¹æ¡ˆåˆå¹¶ä¸ºæ•´ä½“é—®é¢˜çš„è§£ã€‚  

### å¸¸ç”¨ä¾‹å­ï¼š  
1. **å½’å¹¶æ’åºï¼ˆMergeSortï¼‰**  
   - å°†æ•°ç»„åˆ†æˆä¸¤åŠï¼Œå¯¹å·¦å³ä¸¤éƒ¨åˆ†åˆ†åˆ«é€’å½’æ’åºï¼Œç„¶ååˆå¹¶ä¸¤éƒ¨åˆ†ã€‚  
   - åˆå¹¶è¿‡ç¨‹ä¸­éœ€è¦ä½¿ç”¨è¾…åŠ©æ•°ç»„ã€‚  

2. **å¿«é€Ÿæ’åºï¼ˆQuickSortï¼‰**  
   - å°†æ•°ç»„æŒ‰æŸä¸ªåŸºå‡†å€¼åˆ†æˆâ€œè¾ƒå°â€å’Œâ€œè¾ƒå¤§â€ä¸¤éƒ¨åˆ†ï¼Œç„¶ååˆ†åˆ«é€’å½’æ’åºã€‚  

## **å½’å¹¶æ’åºï¼ˆMergeSortï¼‰**  

### **æ­¥éª¤ï¼š**  
1. **åˆ†è§£**ï¼šå°†æ•°ç»„åˆ†ä¸ºå·¦å³ä¸¤éƒ¨åˆ†ã€‚  
2. **å¤„ç†**ï¼šå¯¹å·¦å³éƒ¨åˆ†åˆ†åˆ«é€’å½’æ’åºã€‚  
3. **åˆå¹¶**ï¼šå°†ä¸¤ä¸ªæœ‰åºçš„éƒ¨åˆ†åˆå¹¶ä¸ºä¸€ä¸ªæ•´ä½“ã€‚  

![image-20241120111801819](C:\Totoro.trip\blog-demo\source\images\image-20241120111801819.png)

#### **åˆå¹¶ç®—æ³•ä¼ªä»£ç **  
```pseudo
Merge(A[], T[] : integer array, left, right : integer) {
  mid := (right + left) / 2
  i := left, j := mid + 1, target := left
  while i <= mid and j <= right do
    if A[i] < A[j] then
      T[target] := A[i], i := i + 1
    else
      T[target] := A[j], j := j + 1
    target := target + 1
  end while
  // å°†å‰©ä½™çš„å…ƒç´ å¤åˆ¶åˆ°ç›®æ ‡æ•°ç»„
  while i <= mid do
    T[target] := A[i], i := i + 1, target := target + 1
  while j <= right do
    T[target] := A[j], j := j + 1, target := target + 1
  // å°†ä¸´æ—¶æ•°ç»„ T[] å¤åˆ¶å› A[]
  for k := left to right do
    A[k] := T[k]
}
```

---

### **é€’å½’å®ç°ä¼ªä»£ç **  
```pseudo
Mergesort(A[], T[], left, right : integer) {
  if left < right then
    mid := (left + right) / 2
    Mergesort(A, T, left, mid)      // é€’å½’æ’åºå·¦åŠéƒ¨åˆ†
    Mergesort(A, T, mid + 1, right) // é€’å½’æ’åºå³åŠéƒ¨åˆ†
    Merge(A, T, left, right)       // åˆå¹¶ä¸¤éƒ¨åˆ†
}
```

### **ä¸»å‡½æ•°é©±åŠ¨ä¼ªä»£ç **
```pseudo
MainMergesort(A[], n : integer) {
  T[0..n-1] : integer array
  Mergesort(A, T, 0, n-1)
}
```

---

### **æ—¶é—´å¤æ‚åº¦åˆ†æ**  
- æ¯æ¬¡é€’å½’å°†æ•°ç»„åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œæ€»å…±æœ‰ $\log N$ å±‚ã€‚  
- æ¯ä¸€å±‚éœ€è¦çº¿æ€§æ—¶é—´ $O(N)$ æ¥åˆå¹¶ä¸¤ä¸ªéƒ¨åˆ†ã€‚  
- æ€»æ—¶é—´å¤æ‚åº¦ä¸ºï¼š  
  $
  T(N) = 2T(N/2) + O(N) \implies T(N) = O(N \log N)
  $

### **æ¨å¯¼**  
1. é€’å½’å…³ç³»ï¼š  
   $
   T(N) = 2T(N/2) + bN
   $
2. é™¤ä»¥ $N$ï¼š  
   $
   T(N)/N = T(N/2)/(N/2) + b
   $
3. é€’å½’å±•å¼€å¹¶ç´¯åŠ ï¼š  
   $
   T(N) = aN + bN \log N
   $

---

### **ç‰¹ç‚¹æ€»ç»“**  
1. **æ—¶é—´å¤æ‚åº¦**ï¼š$O(N \log N)$ã€‚  
2. **ç©ºé—´å¤æ‚åº¦**ï¼šéœ€è¦è¾…åŠ©æ•°ç»„ï¼Œç©ºé—´å¤æ‚åº¦ä¸º $O(N)$ã€‚  
3. **ç¨³å®šæ€§**ï¼šæ˜¯ç¨³å®šæ’åºï¼Œä¿æŒç›¸åŒå€¼çš„ç›¸å¯¹é¡ºåºã€‚  
4. **é€‚ç”¨åœºæ™¯**ï¼šé€‚åˆæ’åºå¤§å‹æ•°æ®é›†ï¼Œå°¤å…¶åœ¨éœ€è¦ç¨³å®šæ€§çš„åœºåˆã€‚  

## å½’å¹¶æ’åºçš„å®ç°

### 1. å½’å¹¶æ’åºçš„ä¼ªä»£ç ï¼š

#### åˆå¹¶ç®—æ³•ï¼ˆMergeï¼‰
åˆå¹¶ä¸¤ä¸ªæœ‰åºå­æ•°ç»„çš„æ ¸å¿ƒæ–¹æ³•æ˜¯`Merge`å‡½æ•°ï¼Œå®ƒå°†ä¸¤ä¸ªæœ‰åºéƒ¨åˆ†åˆå¹¶åˆ°ä¸€ä¸ªä¸´æ—¶æ•°ç»„ä¸­ã€‚

```cpp
template <typename Comparable>
void merge(vector<Comparable> &a, vector<Comparable> &tmpArray, int leftPos, int rightPos, int rightEnd) {
    int leftEnd = rightPos - 1;
    int tmpPos = leftPos;
    int numElements = rightEnd - leftPos + 1;
    
    // ä¸»å¾ªç¯ï¼šåˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„
    while (leftPos <= leftEnd && rightPos <= rightEnd) {
        if (a[leftPos] <= a[rightPos]) 
            tmpArray[tmpPos++] = std::move(a[leftPos++]);
        else 
            tmpArray[tmpPos++] = std::move(a[rightPos++]);
    }

    // å¤åˆ¶å‰©ä½™éƒ¨åˆ†
    while (leftPos <= leftEnd) 
        tmpArray[tmpPos++] = std::move(a[leftPos++]);
    while (rightPos <= rightEnd) 
        tmpArray[tmpPos++] = std::move(a[rightPos++]);

    // å°†åˆå¹¶åçš„æ•°æ®å¤åˆ¶å›åŸæ•°ç»„
    for (int i = 0; i < numElements; i++, rightEnd--) 
        a[rightEnd] = std::move(tmpArray[rightEnd]);
}
```

- **è§£é‡Š**ï¼š
    - `a` æ˜¯å¾…æ’åºçš„æ•°ç»„ï¼Œ`tmpArray` æ˜¯ä¸´æ—¶æ•°ç»„ç”¨æ¥å­˜å‚¨åˆå¹¶åçš„ç»“æœã€‚
    - `leftPos` å’Œ `rightPos` åˆ†åˆ«æ˜¯å·¦å³å­æ•°ç»„çš„èµ·å§‹ç´¢å¼•ã€‚
    - `leftEnd` æ˜¯å·¦å­æ•°ç»„çš„ç»“æŸç´¢å¼•ï¼Œ`rightEnd` æ˜¯å³å­æ•°ç»„çš„ç»“æŸç´¢å¼•ã€‚
    - åˆå¹¶æ—¶ï¼Œé€šè¿‡æ¯”è¾ƒå·¦å­æ•°ç»„å’Œå³å­æ•°ç»„çš„å…ƒç´ ï¼Œé€‰æ‹©è¾ƒå°çš„å…ƒç´ æ”¾å…¥ä¸´æ—¶æ•°ç»„ä¸­ï¼Œç›´åˆ°ä¸€ä¸ªå­æ•°ç»„è¢«å®Œå…¨å¤„ç†ã€‚
    - æœ€åï¼Œå°†ä¸´æ—¶æ•°ç»„ä¸­çš„æ•°æ®å¤åˆ¶å›åŸæ•°ç»„ã€‚

### é€’å½’å½’å¹¶æ’åºï¼ˆMergesortï¼‰

```cpp
template <typename Comparable>
void mergesort(vector<Comparable> &a, vector<Comparable> &tmpArray, int left, int right) {
    if (left < right) {
        int mid = (left + right) / 2;
        
        // é€’å½’æ’åºå·¦å³å­æ•°ç»„
        mergesort(a, tmpArray, left, mid);
        mergesort(a, tmpArray, mid + 1, right);
        
        // åˆå¹¶å·²æ’åºçš„å­æ•°ç»„
        merge(a, tmpArray, left, mid + 1, right);
    }
}
```

- **è§£é‡Š**ï¼š
    - `mergesort` æ˜¯å½’å¹¶æ’åºçš„é€’å½’å®ç°ï¼Œé¦–å…ˆé€’å½’åœ°åˆ†å‰²æ•°ç»„ï¼Œç›´åˆ°å­æ•°ç»„å¤§å°ä¸º1ï¼Œç„¶åè°ƒç”¨ `merge` å‡½æ•°å°†ä¸¤ä¸ªæœ‰åºçš„å­æ•°ç»„åˆå¹¶ã€‚
    - `left` å’Œ `right` æ˜¯å½“å‰å¤„ç†å­æ•°ç»„çš„èµ·å§‹å’Œç»“æŸç´¢å¼•ï¼Œ`mid` æ˜¯ä¸­ç‚¹ï¼Œç”¨äºåˆ†å‰²æ•°ç»„ã€‚

### ä¸»ç¨‹åºï¼ˆDriverï¼‰

```cpp
template <typename Comparable>
void MainMergesort(vector<Comparable> &a) {
    vector<Comparable> tmpArray(a.size());
    mergesort(a, tmpArray, 0, a.size() - 1);
}
```

- **è§£é‡Š**ï¼š
    - `MainMergesort` æ˜¯å¤–éƒ¨æ¥å£ï¼Œç”¨äºåˆå§‹åŒ–ä¸´æ—¶æ•°ç»„å¹¶è°ƒç”¨ `mergesort`ã€‚

### 2. å¦ä¸€ç§å®ç°æ–¹å¼ï¼ˆæ’å…¥æ’åºä¼˜åŒ–ï¼‰

å¯¹äºè¾ƒå°çš„å­æ•°ç»„ï¼Œæ’å…¥æ’åºæ¯”å½’å¹¶æ’åºæ›´æœ‰æ•ˆã€‚ä»¥ä¸‹ä»£ç ä½¿ç”¨æ’å…¥æ’åºå¯¹å°æ•°ç»„è¿›è¡Œä¼˜åŒ–ã€‚

```cpp
template <typename E, typename Comp>
void mergesort(E A[], E temp[], int left, int right) {
    if ((right - left) <= THRESHOLD) { // å°æ•°ç»„ä½¿ç”¨æ’å…¥æ’åº
        insertionsort<E, Comp>(&A[left], right - left + 1);
        return;
    }
    int mid = (left + right) / 2;
    
    // é€’å½’æ’åºå·¦å³å­æ•°ç»„
    mergesort<E, Comp>(A, temp, left, mid);
    mergesort<E, Comp>(A, temp, mid + 1, right);

    // åˆå¹¶å·²æ’åºçš„å­æ•°ç»„
    for (int i = mid; i >= left; i--) temp[i] = A[i];
    for (int j = 1; j <= right - mid; j++) temp[right - j + 1] = A[j + mid];  // åå‘é¡ºåº
    for (int i = left, j = right, k = left; k <= right; k++) {
        if (Comp::prior(temp[i], temp[j])) A[k] = temp[i++];
        else A[k] = temp[j--];
    }
}
```

- **è§£é‡Š**ï¼š
    - ä½¿ç”¨æ’å…¥æ’åºæ›¿ä»£å½’å¹¶æ’åºå¤„ç†è¾ƒå°çš„æ•°ç»„ï¼ˆé€šè¿‡ `THRESHOLD` å‚æ•°æ¥æ§åˆ¶ï¼‰ã€‚
    - å°†å·¦å³å­æ•°ç»„å¤åˆ¶åˆ° `temp` ä¸­ï¼Œå¹¶åå‘å¤åˆ¶å³å­æ•°ç»„éƒ¨åˆ†ã€‚
    - æœ€åï¼Œå°†åˆå¹¶åçš„æ•°ç»„è¿”å›åˆ°åŸæ•°ç»„ `A`ã€‚

## å¿«é€Ÿæ’åºï¼ˆQuicksortï¼‰ç®—æ³•

å¿«é€Ÿæ’åºæ˜¯ä¸€ç§ä½¿ç”¨åˆ†æ²»ç­–ç•¥çš„æ’åºç®—æ³•ï¼Œå®ƒä¸å½’å¹¶æ’åºä¸åŒï¼Œå› ä¸ºå®ƒä¸éœ€è¦é¢å¤–çš„O(N)ç©ºé—´ã€‚å¿«é€Ÿæ’åºé€šè¿‡å°†æ•°ç»„åˆ†ä¸ºå·¦å³ä¸¤éƒ¨åˆ†ï¼Œå¹¶é€’å½’åœ°å¯¹è¿™ä¸¤éƒ¨åˆ†è¿›è¡Œæ’åºï¼Œæœ€åå°†å®ƒä»¬åˆå¹¶ã€‚

### å¿«é€Ÿæ’åºçš„æ­¥éª¤
1. **é€‰æ‹©åŸºå‡†å…ƒç´ ï¼ˆpivotï¼‰**ï¼š
   - å¿«é€Ÿæ’åºé€šè¿‡é€‰æ‹©ä¸€ä¸ªå…ƒç´ ä½œä¸ºâ€œåŸºå‡†â€ï¼Œç„¶åå°†æ•°ç»„åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š
     - å·¦å­æ•°ç»„çš„å…ƒç´ éƒ½æ¯”åŸºå‡†å°ã€‚
     - å³å­æ•°ç»„çš„å…ƒç´ éƒ½æ¯”åŸºå‡†å¤§ã€‚
   
2. **é€’å½’æ’åº**ï¼š
   - å¯¹å·¦å­æ•°ç»„å’Œå³å­æ•°ç»„é€’å½’åœ°è¿›è¡Œæ’åºã€‚
   - å¿«é€Ÿæ’åºçš„æ•ˆç‡ä¾èµ–äºåŸºå‡†é€‰æ‹©çš„å¥½åã€‚ç†æƒ³æƒ…å†µä¸‹ï¼ŒåŸºå‡†èƒ½å¤Ÿå°†æ•°ç»„å‡åŒ€åœ°åˆ†æˆä¸¤ä¸ªå­æ•°ç»„ï¼Œç¡®ä¿æ¯æ¬¡åˆ†æ²»æ—¶å­æ•°ç»„çš„å¤§å°æ¥è¿‘ç›¸ç­‰ã€‚

3. **è¿æ¥å·¦å³å­æ•°ç»„**ï¼š
   - å¿«é€Ÿæ’åºé€šè¿‡é€’å½’è¿”å›ï¼Œåœ¨æ’åºè¿‡ç¨‹ä¸­ä¸éœ€è¦é¢å¤–çš„ç©ºé—´ï¼Œåªåœ¨åˆ†æ²»è¿‡ç¨‹ä¸­é€šè¿‡äº¤æ¢å…ƒç´ çš„ä½ç½®æ¥å®ç°ã€‚

### å¿«é€Ÿæ’åºçš„è¿‡ç¨‹
1. **åˆå§‹æ­¥éª¤**ï¼šå¦‚æœæ•°ç»„çš„å…ƒç´ ä¸ªæ•°ä¸º0æˆ–1ï¼Œåˆ™æ•°ç»„å·²ç»æ’åºã€‚
2. **é€‰æ‹©åŸºå‡†å€¼**ï¼šä»æ•°ç»„ä¸­é€‰æ‹©ä¸€ä¸ªå…ƒç´ ä½œä¸ºåŸºå‡†å…ƒç´ ï¼ˆpivotï¼‰ã€‚
3. **åˆ’åˆ†æ“ä½œ**ï¼šå°†æ•°ç»„åˆ†ä¸ºä¸¤ä¸ªå­æ•°ç»„ï¼šS1åŒ…å«æ‰€æœ‰å°äºç­‰äºåŸºå‡†çš„å…ƒç´ ï¼ŒS2åŒ…å«æ‰€æœ‰å¤§äºç­‰äºåŸºå‡†çš„å…ƒç´ ã€‚
4. **é€’å½’æ’åº**ï¼š
   - å¯¹S1å’ŒS2åˆ†åˆ«è¿›è¡Œå¿«é€Ÿæ’åºã€‚
   - è¿”å›é€’å½’æ’åºåçš„ç»“æœã€‚

![image-20241120111844219](C:\Totoro.trip\blog-demo\source\images\image-20241120111844219.png)

### é€‰æ‹©åŸºå‡†ï¼ˆPivotï¼‰
é€‰æ‹©åŸºå‡†æ—¶çš„ç›®æ ‡æ˜¯ï¼šä½¿å¾—å·¦å­æ•°ç»„å’Œå³å­æ•°ç»„çš„å¤§å°æ¥è¿‘ï¼Œå¦‚æœåŸºå‡†é€‰æ‹©ä¸åˆé€‚ï¼Œå¯èƒ½å¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚

**å¸¸è§çš„åŸºå‡†é€‰æ‹©ç­–ç•¥**ï¼š
1. **é€‰æ‹©ç¬¬ä¸€ä¸ªå…ƒç´ **ï¼šå¯¹äºå·²ç»æ’åºæˆ–é€†åºæ’åºçš„æ•°ç»„æ•ˆæœè¾ƒå·®ã€‚
2. **é€‰æ‹©éšæœºä½ç½®çš„å…ƒç´ **ï¼šä½¿ç”¨éšæœºæ•°ç”Ÿæˆå™¨é€‰æ‹©åŸºå‡†å…ƒç´ ï¼Œä½†å¯èƒ½ä¼šæœ‰é¢å¤–çš„æ€§èƒ½å¼€é”€ã€‚
3. **é€‰æ‹©ä¸­é—´ä½ç½®çš„å…ƒç´ **ï¼šé€‰æ‹© `(left + right) / 2` ä½ç½®çš„å…ƒç´ ä½œä¸ºåŸºå‡†ã€‚
4. **ä¸‰æ•°ä¸­å€¼æ³•ï¼ˆMedian-of-Threeï¼‰**ï¼šé€‰æ‹©å·¦ç«¯ã€å³ç«¯å’Œä¸­é—´å…ƒç´ ä¸­çš„ä¸­ä½æ•°ä½œä¸ºåŸºå‡†ã€‚

### åˆ’åˆ†ç­–ç•¥
åˆ’åˆ†çš„ç›®çš„æ˜¯å°†æ•°ç»„åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œå·¦è¾¹çš„å…ƒç´ éƒ½æ¯”åŸºå‡†å°ï¼Œå³è¾¹çš„å…ƒç´ éƒ½æ¯”åŸºå‡†å¤§ã€‚å¸¸è§çš„åˆ’åˆ†æ–¹æ³•æ˜¯â€œåŒæŒ‡é’ˆæ³•â€ï¼š

- ä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆiå’Œjï¼ŒæŒ‡é’ˆiä»å·¦è¾¹å¼€å§‹ï¼ŒæŒ‡é’ˆjä»å³è¾¹å¼€å§‹ã€‚
- **æ­¥éª¤**ï¼š
  - ç§»åŠ¨æŒ‡é’ˆiï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªå¤§äºåŸºå‡†çš„å…ƒç´ ã€‚
  - ç§»åŠ¨æŒ‡é’ˆjï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªå°äºåŸºå‡†çš„å…ƒç´ ã€‚
  - äº¤æ¢è¿™ä¸¤ä¸ªå…ƒç´ ã€‚
  - é‡å¤ä¸Šè¿°æ“ä½œç›´åˆ°iå’Œjäº¤å‰ã€‚
  - æœ€åï¼Œå°†åŸºå‡†å…ƒç´ äº¤æ¢åˆ°åˆé€‚çš„ä½ç½®ã€‚

### å¿«é€Ÿæ’åºçš„å®ç°ä»£ç 
```cpp
template <typename E, typename Comp>
void quickSort(E A[], int i, int j) {
    if (j <= i) return;  // æ•°ç»„ä¸ºç©ºæˆ–åªæœ‰ä¸€ä¸ªå…ƒç´ æ—¶è¿”å›

    int pivotIndex = findPivot(A, i, j);  // è·å–åŸºå‡†å…ƒç´ 
    swap(A, pivotIndex, j);  // å°†åŸºå‡†å…ƒç´ æ”¾åˆ°æœ«å°¾

    // k æ˜¯å³å­æ•°ç»„çš„èµ·å§‹ä½ç½®
    int k = partition<E, Comp>(A, i, j - 1, A[j]);
    swap(A, k, j);  // å°†åŸºå‡†å…ƒç´ æ”¾å›å…¶æ­£ç¡®çš„ä½ç½®

    // é€’å½’å¯¹å·¦å³å­æ•°ç»„è¿›è¡Œæ’åº
    quickSort<E, Comp>(A, i, k - 1);
    quickSort<E, Comp>(A, k + 1, j);
}

template <typename E, typename Comp>
int partition(E A[], int l, int r, E& pivot) {
    do {
        // ç§»åŠ¨æŒ‡é’ˆç›´åˆ°å®ƒä»¬ç›¸é‡
        while (Comp::prior(A[++l], pivot));
        while ((l < r) && Comp::prior(A[--r], pivot));
        // äº¤æ¢ä¸ç¬¦åˆæ¡ä»¶çš„å…ƒç´ 
        swap(A, l, r);
    } while (l < r);  // å½“æŒ‡é’ˆç›¸é‡æ—¶åœæ­¢
    swap(A, l, r);  // æœ€åä¸€äº¤æ¢
    return l;  // è¿”å›å³å­æ•°ç»„çš„èµ·å§‹ä½ç½®
}
```

### Example

![image-20241120111918999](C:\Totoro.trip\blog-demo\source\images\image-20241120111918999.png)

![image-20241120111929474](C:\Totoro.trip\blog-demo\source\images\image-20241120111929474.png)

### å¿«é€Ÿæ’åºï¼ˆQuicksortï¼‰ç®—æ³•åˆ†æ

#### æœ€ä½³æƒ…å†µï¼ˆBest Caseï¼‰
- åœ¨æœ€ä½³æƒ…å†µä¸‹ï¼Œå¿«é€Ÿæ’åºæ€»æ˜¯èƒ½å¤Ÿé€‰æ‹©æœ€ä¼˜çš„åŸºå‡†ï¼Œå¹¶å°†æ•°ç»„åˆ†æˆå‡ ä¹ç›¸ç­‰çš„ä¸¤ä¸ªå­æ•°ç»„ã€‚
- é€’å½’åˆ†å‰²åçš„æ—¶é—´å¤æ‚åº¦æ˜¯ï¼š
  $
  T(N) = 2T(N/2) + O(N)
  $
- è¿™æ˜¯ä¸å½’å¹¶æ’åºç›¸åŒçš„é€’å½’å…³ç³»ï¼Œå› æ­¤åœ¨æœ€ä½³æƒ…å†µä¸‹ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º $ T(N) = O(N \log N) $ã€‚

#### æœ€åæƒ…å†µï¼ˆWorst Caseï¼‰
- åœ¨æœ€åæƒ…å†µä¸‹ï¼Œæ¯æ¬¡åŸºå‡†éƒ½é€‰æ‹©å¾—éå¸¸å·®ï¼Œå¯¼è‡´å…¶ä¸­ä¸€ä¸ªå­æ•°ç»„ä¸ºç©ºï¼ˆä¾‹å¦‚ï¼ŒåŸºå‡†æ€»æ˜¯é€‰æ‹©æ•°ç»„çš„æœ€å¤§å€¼æˆ–æœ€å°å€¼ï¼‰ã€‚
- é€’å½’åˆ†å‰²åçš„æ—¶é—´å¤æ‚åº¦æ˜¯ï¼š
  $
  T(N) = T(N-1) + O(N)
  $
  $
  T(N) = T(N-2) + O(N-1) + O(N)
  $
  $
  T(N) = T(1) + O(1 + 2 + \dots + (N-1) + N)
  $
  $
  T(N) = O(1) + O(N^2)
  $
- å› æ­¤ï¼Œåœ¨æœ€åæƒ…å†µä¸‹ï¼Œå¿«é€Ÿæ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸º $ T(N) = O(N^2) $ã€‚

#### å¹³å‡æƒ…å†µï¼ˆAverage Caseï¼‰
å¹¸è¿çš„æ˜¯ï¼Œå¿«é€Ÿæ’åºçš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º $ O(N \log N) $ï¼Œè¿™ä¹Ÿæ˜¯å¤§å¤šæ•°å®é™…åº”ç”¨ä¸­çš„æ—¶é—´å¤æ‚åº¦ã€‚

### å¿«é€Ÿæ’åºçš„å±æ€§

1. **ä¸ç¨³å®šæ’åº**ï¼š
   - å¿«é€Ÿæ’åºæ˜¯ä¸€ä¸ªä¸ç¨³å®šçš„æ’åºç®—æ³•ã€‚ç”±äºåœ¨æ’åºè¿‡ç¨‹ä¸­ä¼šå‘ç”Ÿå…ƒç´ äº¤æ¢ï¼Œå› æ­¤å¯èƒ½ä¼šæ”¹å˜ç›¸ç­‰å…ƒç´ ä¹‹é—´çš„ç›¸å¯¹é¡ºåºã€‚

2. **ä¸é€‚åˆå°æ•°ç»„**ï¼š
   - å¯¹äºå°è§„æ¨¡æ•°ç»„ï¼Œå¿«é€Ÿæ’åºçš„æ€§èƒ½è¾ƒå·®ã€‚é€šå¸¸å¯ä»¥ä½¿ç”¨æ’å…¥æ’åºæ¥å¤„ç†å°æ•°ç»„ï¼Œä»¥æå‡æ•ˆç‡ã€‚

3. **åŸåœ°æ’åº**ï¼š
   - å¿«é€Ÿæ’åºæ˜¯ä¸€ç§â€œåŸåœ°æ’åºâ€ç®—æ³•ï¼Œå®ƒä¸éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´æ¥å­˜æ”¾ä¸´æ—¶æ•°ç»„ã€‚
   - ç„¶è€Œï¼Œç”±äºé€’å½’è°ƒç”¨çš„å­˜åœ¨ï¼Œå®ƒéœ€è¦ $ O(\log N) $ çš„è¾…åŠ©ç©ºé—´æ¥ä¿å­˜é€’å½’æ ˆã€‚

4. **å¹³å‡æƒ…å†µæ€§èƒ½**ï¼š
   - å¿«é€Ÿæ’åºåœ¨å¹³å‡æƒ…å†µä¸‹å…·æœ‰ $ O(N \log N) $ çš„æ—¶é—´å¤æ‚åº¦ã€‚å°½ç®¡æœ€åæƒ…å†µä¸‹æ—¶é—´å¤æ‚åº¦ä¸º $ O(N^2) $ï¼Œä½†åœ¨å¤§å¤šæ•°éšæœºæ•°æ®ä¸Šï¼Œå®ƒè¡¨ç°å¾—éå¸¸é«˜æ•ˆã€‚

5. **â€œå¿«é€Ÿæ’åºæ˜¯æœ€ä½³çš„å†…å­˜æ’åºç®—æ³•â€**ï¼š
   - å¿«é€Ÿæ’åºçš„ç©ºé—´å ç”¨éå¸¸å°ï¼Œå…·æœ‰è‰¯å¥½çš„å†…å­˜å±€éƒ¨æ€§ã€‚ç”±äºå…¶é€’å½’çš„ç‰¹æ€§ï¼Œå¿«é€Ÿæ’åºåœ¨å†…å­˜å±‚æ¬¡ç»“æ„ï¼ˆå¦‚CPUç¼“å­˜ï¼‰ä¸­ä¹Ÿè¡¨ç°å‡ºè‰²ã€‚

6. **æ¯”è¾ƒæ¬¡æ•°å°‘**ï¼š
   - å¿«é€Ÿæ’åºå¹³å‡æ¥è¯´ä½¿ç”¨çš„æ¯”è¾ƒæ¬¡æ•°å¾ˆå°‘ï¼Œç›¸è¾ƒäºå…¶ä»–æ’åºç®—æ³•ï¼Œå¿«é€Ÿæ’åºèƒ½å¤Ÿæ›´å°‘çš„è¿›è¡Œå…ƒç´ æ¯”è¾ƒï¼Œä»è€Œæå‡æ’åºæ•ˆç‡ã€‚

7. **å°å†…å­˜å ç”¨**ï¼š
   - å¿«é€Ÿæ’åºçš„â€œè¶³è¿¹â€è¾ƒå°ï¼Œä½¿ç”¨è¾ƒå°‘çš„å†…å­˜ç©ºé—´ï¼Œå› æ­¤é€‚åˆåœ¨å†…å­˜å—é™çš„ç¯å¢ƒä¸­ä½¿ç”¨ã€‚

### ç»“è®º
- **å¿«é€Ÿæ’åº**æ˜¯ä¸€ç§é«˜æ•ˆçš„æ’åºç®—æ³•ï¼Œé€šå¸¸å…·æœ‰ $ O(N \log N) $ çš„å¹³å‡æ—¶é—´å¤æ‚åº¦ã€‚
- **æœ€åæƒ…å†µ**æ—¶é—´å¤æ‚åº¦ä¸º $ O(N^2) $ï¼Œä½†æ˜¯é€šè¿‡ä¼˜åŒ–åŸºå‡†é€‰æ‹©ï¼ˆä¾‹å¦‚éšæœºé€‰æ‹©æˆ–ä¸‰æ•°ä¸­å€¼æ³•ï¼‰ï¼Œå¯ä»¥æœ‰æ•ˆé¿å…æœ€åæƒ…å†µçš„å‘ç”Ÿã€‚
- å¿«é€Ÿæ’åºå› å…¶ä¼˜ç§€çš„å†…å­˜è¡¨ç°å’Œè¾ƒä½çš„æ¯”è¾ƒæ¬¡æ•°ï¼Œåœ¨å¤§å¤šæ•°å®é™…åº”ç”¨ä¸­æ˜¯æœ€å¸¸ç”¨çš„æ’åºç®—æ³•ä¹‹ä¸€ã€‚